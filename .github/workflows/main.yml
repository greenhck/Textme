name: Aura Market Daily Update

on:
  schedule:
    - cron: '54 06 * * *' # Runs daily at 06:54 UTC (12:24 PM IST)
  workflow_dispatch:

jobs:
  update-scores:
    permissions:
      contents: write
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install google-generativeai python-dateutil pytz

      - name: Run update script
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python update.py

      # --- ‡§™‡•Å‡§∞‡§æ‡§®‡§æ Git ‡§∏‡•ç‡§ü‡•á‡§™ ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ (Removed old Git step) ---
      
      - name: Commit and push changes using auto-commit action üîÑ
        uses: stefanzweifel/git-auto-commit-action@v5 # <<< ‡§Ø‡§π ‡§®‡§Ø‡§æ ‡§è‡§ï‡•ç‡§∂‡§® ‡§π‡•à
        with:
          # ‡§π‡§Æ ‡§∏‡§ø‡§∞‡•ç‡§´‡§º data.json ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã ‡§ï‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç
          file_pattern: 'data.json'
          # ‡§ï‡§Æ‡§ø‡§ü ‡§Æ‡•à‡§∏‡•á‡§ú (Commit Message)
          commit_message: "üìà Aura Market Daily Update: ${{ github.run_id }}"
          # ‡§¨‡•â‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ (Bot Details)
          commit_user_name: 'github-actions[bot]'
          commit_user_email: 'github-actions[bot]@users.noreply.github.com'
