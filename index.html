<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flux - Aura Market</title>
    <!-- We still include chart.js because the original code used it, 
         but the chart rendering logic is removed as per request. -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Load Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --bg-color: #121212;
            --surface-color: #1E1E1E;
            --text-color: #E0E0E0;
            --border-color: #333333;
            --positive-color: #00C853; /* A vibrant green */
            --negative-color: #D50000; /* A strong red */
            --highlight-color: #007ACC;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        .header {
            background-color: var(--surface-color);
            padding: 15px 20px 10px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        /* NEW: Wrapper for title and time alignment */
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 500;
            letter-spacing: 1px;
            text-align: left; /* Left align title */
        }
        
        .last-updated-time { /* NEW: for time only, right aligned */
            font-size: 0.9em;
            color: #888;
            margin-top: 0; 
            text-align: right; /* Right align time */
            white-space: nowrap;
        }
        
        /* Old .last-updated is now obsolete, replacing with .last-updated-time */
        .last-updated { 
            display: none; 
        }

        .main-container {
            padding: 0 10px 10px; 
        }
        
        /* New Styles for Icon Bar and Search */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .icon-group {
            display: flex;
            gap: 15px;
        }
        
        .action-text {
            color: #ccc;
            font-size: 0.85em;
            font-style: italic;
        }

        .icon-button {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 1.2em;
            transition: color 0.2s;
            padding: 5px;
            border-radius: 50%;
        }

        .icon-button:hover {
            color: var(--highlight-color);
            background-color: #2a2a2a;
        }
        
        .search-input-container {
            flex-grow: 1;
            margin-right: 15px;
            display: none; /* Hidden by default */
            transition: all 0.3s ease-in-out;
        }
        
        #search-input {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: #333;
            color: var(--text-color);
            font-size: 0.9em;
        }

        .aura-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* Ensures fixed column widths */
        }

        .aura-table th, .aura-table td {
            padding: 10px 5px; /* Reduced padding for mobile fit */
            text-align: right;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
            overflow: hidden; /* Important for fixed layout */
            text-overflow: ellipsis; /* Optional for long names */
        }

        .aura-table th {
            font-size: 0.8em;
            color: #aaa;
            text-transform: uppercase;
            font-weight: 600;
            cursor: pointer;
            position: sticky;
            top: 70px; /* Below the header and icon-bar */
            background-color: #181818;
            border-top: 1px solid var(--border-color);
            transition: background-color 0.1s;
        }
        
        .aura-table th:hover {
            background-color: #2a2a2a;
        }
        
        .aura-table th.sorted {
            color: var(--highlight-color);
        }
        
        /* Column Widths adjusted for 4 columns */
        .aura-table th.name-header, .aura-table td.name-cell {
            text-align: left;
            font-weight: 600;
            width: 30%; 
        }

        /* Remaining 3 columns (Aura Score, Today's Change, YCS) */
        .aura-table th:nth-child(2),
        .aura-table th:nth-child(3),
        .aura-table th:nth-child(4) { 
            width: 23.33%; /* (100% - 30%) / 3 = 23.33% each */
        }
        
        .aura-table td.name-cell {
             font-size: 0.95em;
        }

        .aura-table tbody tr {
            transition: background-color 0.2s ease;
        }

        .aura-table tbody tr:hover {
            background-color: #2a2a2a;
        }

        .aura-score {
            font-weight: bold;
            font-size: 1.0em;
        }

        .change-values {
            font-weight: 600;
        }

        .positive {
            color: var(--positive-color);
        }

        .negative {
            color: var(--negative-color);
        }

        /* Custom Modal (replacing alert/confirm) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background-color: var(--surface-color);
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content h3 {
            color: var(--highlight-color);
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .modal-content p {
            line-height: 1.5;
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #ccc;
        }

        .modal-close {
            background-color: var(--highlight-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            float: right;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background-color: #005f99;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile Responsive Shortcuts: Hides 'Today's Change' column (now 3rd) */
        @media (max-width: 600px) {
            body {
                font-size: 13px;
            }
            .header h1 {
                font-size: 1.4em;
            }
            .aura-table th, .aura-table td {
                padding: 10px 3px;
            }
            /* Hides the 'Today's Change' (3rd) column on small screens */
            .aura-table th:nth-child(3), 
            .aura-table td:nth-child(3) {
                display: none;
            }
            .icon-group {
                gap: 10px;
            }
            .action-text {
                font-size: 0.75em;
            }
            .aura-table th.name-header, .aura-table td.name-cell {
                width: 35%;
            }
            /* Remaining 2 columns (2nd, 4th) */
            .aura-table th:nth-child(2), 
            .aura-table th:nth-child(4) { 
                width: 32.5%; /* (100% - 35%) / 2 = 32.5% each */
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-content">
            <h1>Flux - Aura Market</h1>
            <div class="last-updated-time">
                <span id="update-time">--:--</span> IST
            </div>
        </div>
    </header>
    
    <div class="action-bar">
        <div class="icon-group">
            <button class="icon-button" id="search-icon" title="Search Name"><i class="fas fa-search"></i></button>
            <button class="icon-button" id="info-icon" title="How is Aura Score calculated?"><i class="fas fa-question-circle"></i></button>
            <a href="https://t.me/lovelyakash41" target="_blank" class="icon-button" id="telegram-icon" title="Contact on Telegram"><i class="fab fa-telegram-plane"></i></a>
        </div>
        <div class="action-text">measure Aura.</div>
    </div>
    
    <div class="main-container">
        <!-- Search Input Field -->
        <div class="search-input-container" id="search-input-container">
            <input type="text" id="search-input" placeholder="Search by Name...">
        </div>
        
        <table class="aura-table">
            <thead>
                <tr>
                    <th class="name-header" data-sort-key="name">Name <i class="fas fa-sort"></i></th>
                    <th data-sort-key="aura_score">Aura Score <i class="fas fa-sort"></i></th>
                    <!-- REMOVED: Change % Column -->
                    <th data-sort-key="today_change">Today's Change <i class="fas fa-sort"></i></th>
                    <th data-sort-key="today_change">YCS <i class="fas fa-sort"></i></th> <!-- YCS now uses same sort key as it displays the same change value -->
                </tr>
            </thead>
            <tbody id="aura-data">
                <!-- Data will be dynamically inserted here -->
            </tbody>
        </table>
    </div>
    
    <!-- Custom Modal Structure -->
    <div class="modal-overlay" id="info-modal-overlay">
        <div class="modal-content">
            <h3>How Aura Score is Calculated</h3>
            <p>Aura Score is a dynamic metric reflecting an individual's perceived influence and activity. It is calculated based on a weighted average of real-time data points, which may include:</p>
            <ul>
                <li>Social media engagement (likes, shares, comments)</li>
                <li>Search engine trends and queries</li>
                <li>Media mentions and sentiment analysis</li>
                <li>Recent professional achievements or public events</li>
            </ul>
            <p>The score updates frequently, and its movement reflects market sentiment around the individual.</p>
            <!-- UPDATED: Removed CP and updated YCS definition -->
            <p>
                **Shortcut Full Forms:**<br>
                **AS** (Aura Score), 
                **TC** (Today's Change), 
                **YCS** (Yesterday Change Score, which is the daily change value).
            </p>
            <button class="modal-close" id="modal-close-button">Close</button>
        </div>
    </div>

    <script>
        // Global variables to store data and sorting state
        let allCelebrities = [];
        let sortColumn = 'aura_score'; 
        let sortDirection = 'desc'; // Default: high to low
        
        // --- Utility Functions for Sorting ---
        
        function getSortValue(item, key) {
            // Special handling for calculated values
            if (key === 'today_change') {
                return item.aura_score - item.previous_aura_score;
            }
            // Default for direct properties (name, aura_score)
            return item[key];
        }

        function sortData(data) {
            data.sort((a, b) => {
                const valA = getSortValue(a, sortColumn);
                const valB = getSortValue(b, sortColumn);
                
                let comparison = 0;
                
                // For strings (like name), use localeCompare
                if (typeof valA === 'string' && typeof valB === 'string') {
                    comparison = valA.localeCompare(valB);
                } else {
                    // For numbers
                    if (valA < valB) {
                        comparison = -1;
                    } else if (valA > valB) {
                        comparison = 1;
                    }
                }

                // Apply direction
                return sortDirection === 'desc' ? comparison * -1 : comparison;
            });
            return data;
        }

        // --- Data Fetching and Rendering ---

        async function fetchDataAndRender() {
            try {
                // Fetch data, ensuring a unique query to avoid browser cache
                const response = await fetch(`data.json?v=${new Date().getTime()}`);
                const data = await response.json();
                
                document.getElementById('update-time').textContent = data.last_updated;
                allCelebrities = data.celebrities; // Store the initial data

                renderTable(); // Initial render and sort
                
            } catch (error) {
                console.error('Error fetching Aura Market data:', error);
            }
        }

        function renderTable(filterQuery = '') {
            const tableBody = document.getElementById('aura-data');
            const filteredData = filterQuery 
                ? allCelebrities.filter(c => c.name.toLowerCase().includes(filterQuery.toLowerCase()))
                : allCelebrities;
            
            const sortedData = sortData([...filteredData]); // Sort a copy
            
            tableBody.innerHTML = ''; // Clear old data

            // Update header class to show current sort state
            document.querySelectorAll('.aura-table th').forEach(th => {
                th.classList.remove('sorted');
                if (th.getAttribute('data-sort-key') === sortColumn) {
                    th.classList.add('sorted');
                }
            });


            sortedData.forEach(celeb => {
                const row = document.createElement('tr');

                // Calculations
                const todayChange = celeb.aura_score - celeb.previous_aura_score;
                const changeClass = todayChange >= 0 ? 'positive' : 'negative';
                const sign = todayChange >= 0 ? '+' : '';

                row.innerHTML = `
                    <td class="name-cell">${celeb.name}</td>
                    <td class="aura-score">${celeb.aura_score.toFixed(2)}</td>
                    <td class="change-values ${changeClass}">${sign}${todayChange.toFixed(2)}</td> <!-- Today's Change (3rd column) -->
                    <td class="change-values ${changeClass}">${sign}${todayChange.toFixed(2)}</td> <!-- YCS (4th column, showing change) -->
                `;
                tableBody.appendChild(row);
            });
        }
        
        // --- Event Listeners and Initialization ---

        document.addEventListener('DOMContentLoaded', () => {
            fetchDataAndRender();
            attachSortingListeners();
            attachIconListeners();
            attachSearchListener();
        });
        
        function attachSortingListeners() {
            document.querySelectorAll('.aura-table th').forEach(header => {
                const key = header.getAttribute('data-sort-key');
                if (key) {
                    header.addEventListener('click', () => {
                        // Toggle direction or change column
                        if (sortColumn === key) {
                            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                        } else {
                            sortColumn = key;
                            // Default direction for Name is ASC, others DESC
                            sortDirection = key === 'name' ? 'asc' : 'desc';
                        }
                        renderTable(document.getElementById('search-input').value);
                    });
                }
            });
        }
        
        function attachIconListeners() {
            // 1. Search Icon Toggle
            const searchIcon = document.getElementById('search-icon');
            const searchContainer = document.getElementById('search-input-container');
            searchIcon.addEventListener('click', () => {
                searchContainer.style.display = searchContainer.style.display === 'block' ? 'none' : 'block';
                if (searchContainer.style.display === 'block') {
                    document.getElementById('search-input').focus();
                } else {
                    document.getElementById('search-input').value = '';
                    renderTable(''); // Clear filter when hiding search
                }
            });
            
            // 2. Info Icon Modal
            const infoIcon = document.getElementById('info-icon');
            const infoModal = document.getElementById('info-modal-overlay');
            const modalCloseButton = document.getElementById('modal-close-button');
            
            infoIcon.addEventListener('click', () => {
                infoModal.style.display = 'flex';
            });
            
            modalCloseButton.addEventListener('click', () => {
                infoModal.style.display = 'none';
            });
            
            infoModal.addEventListener('click', (e) => {
                // Close when clicking outside the modal content
                if (e.target === infoModal) {
                    infoModal.style.display = 'none';
                }
            });
            
            // 3. Telegram Link: handled by the <a> tag in HTML
        }
        
        function attachSearchListener() {
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                renderTable(e.target.value.trim());
            });
        }
    </script>
</body>
</html>
