<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flux - Aura Market</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Tailwind Configuration (using Inter font and a professional dark palette) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        :root {
            /* Professional Dark Mode Palette */
            --color-bg-primary: #0a0a0a; /* Deep Black */
            --color-bg-surface: #1f2937; /* Slightly Lighter Slate */
            --color-text-main: #f9fafb; /* White */
            --color-text-secondary: #9ca3af; /* Gray */
            --color-accent: #3b82f6; /* Blue (Tech/Finance Accent) */
            --color-positive: #10b981; /* Emerald Green */
            --color-negative: #ef4444; /* Red */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-primary);
            color: var(--color-text-main);
            margin: 0;
            min-height: 100vh;
        }

        /* Enforce professional right alignment for numbers */
        .numeric {
            text-align: right;
            font-weight: 600;
            font-variant-numeric: tabular-nums; /* Align decimals */
        }
        
        /* Animation for loading spinner */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Help Modal (Hidden by default) -->
    <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg shadow-2xl max-w-lg w-full p-6 border border-gray-700">
            <div class="flex justify-between items-center pb-3 border-b border-gray-700">
                <h3 class="text-xl font-bold text-white">‡§ë‡§∞‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§ï‡•Ä ‡§ó‡§£‡§®‡§æ ‡§ï‡•à‡§∏‡•á ‡§π‡•ã‡§§‡•Ä ‡§π‡•à?</h3>
                <button onclick="toggleHelpModal(false)" class="text-gray-400 hover:text-white transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"/><path d="M6 6L18 18"/></svg>
                </button>
            </div>
            <p class="mt-4 text-gray-300">
                ‡§ë‡§∞‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞ (Aura Score) ‡§è‡§ï **AI-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§á‡§Ç‡§°‡•á‡§ï‡•ç‡§∏** ‡§π‡•à‡•§ ‡§Ø‡§π ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∏‡•á‡§≤‡§ø‡§¨‡•ç‡§∞‡§ø‡§ü‡•Ä ‡§Ø‡§æ ‡§á‡§ï‡§æ‡§à ‡§ï‡•Ä ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§∑‡•ç‡§†‡§æ ‡§î‡§∞ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ ‡§ï‡•ã ‡§¶‡§∞‡•ç‡§∂‡§æ‡§§‡§æ ‡§π‡•à‡•§
            </p>
            <p class="mt-2 text-sm text-gray-400">
                ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ (`update.py` ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á Gemini API ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á) ‡§™‡§ø‡§õ‡§≤‡•á 24 ‡§ò‡§Ç‡§ü‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡•Ä‡§°‡§ø‡§Ø‡§æ ‡§ï‡§µ‡§∞‡•á‡§ú, ‡§∏‡•ã‡§∂‡§≤ ‡§Æ‡•Ä‡§°‡§ø‡§Ø‡§æ ‡§∏‡•á‡§Ç‡§ü‡•Ä‡§Æ‡•á‡§Ç‡§ü, ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§ò‡•ã‡§∑‡§£‡§æ‡§ì‡§Ç ‡§î‡§∞ ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§∏‡•ç‡§ï‡•ã‡§∞ 0 ‡§∏‡•á 2000 ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§ú‡§π‡§æ‡§Ç ‡§â‡§ö‡•ç‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§∏‡§ï‡§æ‡§∞‡§æ‡§§‡•ç‡§Æ‡§ï ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ ‡§î‡§∞ ‡§™‡•ç‡§∞‡§§‡§ø‡§∑‡•ç‡§†‡§æ ‡§ï‡•ã ‡§¶‡§∞‡•ç‡§∂‡§æ‡§§‡§æ ‡§π‡•à‡•§
            </p>
        </div>
    </div>

    <!-- Header: Sticky and Professional (Full Width) -->
    <header class="sticky top-0 z-10 bg-[--color-bg-surface] shadow-xl border-b border-gray-700">
        <div class="w-full px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[--color-accent]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2v-7.5"/><path d="M17.5 7.5L20 5 22.5 7.5"/><path d="M17.5 10.5L20 13 22.5 10.5"/><path d="M19 14.5L20 12l1-2.5"/></svg>
                <h1 class="text-2xl font-bold tracking-tight text-white">Flux - Aura Market</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-xs text-right hidden sm:block">
                    <span class="text-[--color-text-secondary]">Last Indexed:</span> 
                    <span id="update-time" class="font-medium text-white">--:-- IST</span>
                </div>
                <!-- Help Icon Button -->
                <button onclick="toggleHelpModal(true)" class="p-2 rounded-full hover:bg-gray-700 transition" title="Aura Score ‡§ó‡§£‡§®‡§æ ‡§ï‡•à‡§∏‡•á ‡§π‡•ã‡§§‡•Ä ‡§π‡•à">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Container (Full Width) -->
    <main class="w-full px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- 1. Top Movers Summary Cards -->
        <div id="movers-summary" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Highest Growth Card -->
            <div id="top-mover-card" class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                <p class="text-sm font-medium text-gray-400">üìà Highest Daily Growth</p>
                <h2 class="text-2xl font-bold mt-1 text-white truncate" id="top-mover-name">-- Loading --</h2>
                <div class="flex items-center mt-2">
                    <span id="top-mover-movement" class="text-xl font-bold text-green-400">0.00</span>
                    <span id="top-mover-percent" class="ml-3 text-sm font-medium text-green-400"> (0.00%)</span>
                </div>
            </div>
            <!-- Lowest Growth Card -->
            <div id="bottom-mover-card" class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                <p class="text-sm font-medium text-gray-400">üìâ Lowest Daily Growth</p>
                <h2 class="text-2xl font-bold mt-1 text-white truncate" id="bottom-mover-name">-- Loading --</h2>
                <div class="flex items-center mt-2">
                    <span id="bottom-mover-movement" class="text-xl font-bold text-red-400">0.00</span>
                    <span id="bottom-mover-percent" class="ml-3 text-sm font-medium text-red-400"> (0.00%)</span>
                </div>
            </div>
        </div>

        <!-- 2. Controls Bar (Search and Sort/Filter) -->
        <div class="bg-[--color-bg-surface] p-4 rounded-t-xl flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 sm:space-x-4 border-b border-gray-700">
            <!-- Search Input -->
            <div class="relative w-full sm:w-80">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3">
                    <!-- Search Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21L16.65 16.65"/></svg>
                </div>
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="Search Celebrity Name..." 
                    oninput="handleSearchAndSort()"
                    class="w-full bg-gray-700 text-white rounded-lg pl-10 pr-10 py-2.5 border border-gray-600 focus:ring-blue-500 focus:border-blue-500"
                >
                <div id="loading-spinner" class="absolute inset-y-0 right-0 hidden flex items-center pr-3">
                    <!-- Rotating Loading Animation Icon (used for search/sort) -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 animate-spin-slow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 11-6.219-8.56"/></svg>
                </div>
            </div>

            <!-- Sort Dropdown -->
            <div class="flex items-center space-x-2 w-full sm:w-auto">
                <label for="sort-select" class="text-gray-400 text-sm whitespace-nowrap hidden sm:block">Sort By:</label>
                <select id="sort-select" onchange="handleSearchAndSort()" class="bg-gray-700 text-white rounded-lg py-2.5 px-3 border border-gray-600 focus:ring-blue-500 focus:border-blue-500">
                    <option value="score_desc">Aura Score (High to Low)</option>
                    <option value="score_asc">Aura Score (Low to High)</option>
                    <option value="change_desc">Daily Growth (High to Low)</option>
                    <option value="change_asc">Daily Growth (Low to High)</option>
                    <option value="name_asc">Name (A-Z)</option>
                </select>
            </div>
        </div>

        <!-- 3. Main Data Table -->
        <div class="bg-[--color-bg-surface] shadow-2xl rounded-b-xl overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                
                <!-- Table Header -->
                <thead class="bg-gray-800 sticky top-[68px]"> <!-- Adjusted sticky position below the main header -->
                    <tr>
                        <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-400 sm:pl-6">
                            Celebrity
                        </th>
                        <th scope="col" class="px-3 py-3.5 text-right text-sm font-semibold text-gray-400">
                            Aura Score (AS)
                        </th>
                        <th scope="col" class="hidden sm:table-cell px-3 py-3.5 text-right text-sm font-semibold text-gray-400">
                            Previous Day's AS
                        </th>
                        <th scope="col" class="px-3 py-3.5 text-right text-sm font-semibold text-gray-400">
                            Net Movement
                        </th>
                        <th scope="col" class="px-3 py-3.5 text-right text-sm font-semibold text-gray-400">
                            Daily % Chg
                        </th>
                    </tr>
                </thead>
                
                <!-- Table Body -->
                <tbody id="aura-data" class="divide-y divide-gray-800">
                    <!-- Loading Spinner instead of text for initial load -->
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-400 animate-spin-slow mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 11-6.219-8.56"/></svg>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', fetchData);

        let rawAuraData = []; // Stores the fetched data
        const tableBody = document.getElementById('aura-data');
        const loadingSpinner = document.getElementById('loading-spinner');
        
        // --- Helper Functions ---

        /** Toggles the visibility of the help modal. */
        function toggleHelpModal(show) {
            document.getElementById('help-modal').style.display = show ? 'flex' : 'none';
        }

        /** Formats the movement value and returns it with sign and appropriate color class. */
        function formatMovement(movement) {
            const isPositive = movement >= 0;
            const sign = isPositive ? '+' : '';
            const colorClass = isPositive ? 'text-green-400' : 'text-red-400';
            return {
                text: `${sign}${movement.toFixed(2)}`,
                class: colorClass,
                isPositive
            };
        }
        
        /** HTML string for the spinning loading circle */
        const SPINNER_HTML = `
            <tr>
                <td colspan="5" class="px-6 py-8 text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-400 animate-spin-slow mx-auto" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 11-6.219-8.56"/></svg>
                </td>
            </tr>
        `;

        // --- Core Data Functions ---

        /**
         * Fetches data from data.json and populates the rawAuraData array.
         */
        async function fetchData() {
            loadingSpinner.classList.remove('hidden');
            // Show spinner in the main table
            tableBody.innerHTML = SPINNER_HTML; 

            try {
                const response = await fetch(`data.json?v=${new Date().getTime()}`);
                const data = await response.json();
                
                // 1. Process Raw Data
                rawAuraData = data.celebrities.map(celeb => {
                    const netMovement = celeb.aura_score - celeb.previous_aura_score;
                    const changePercentage = celeb.previous_aura_score === 0 ? 0 : (netMovement / celeb.previous_aura_score) * 100;
                    return {
                        ...celeb,
                        netMovement,
                        changePercentage
                    };
                });
                
                // 2. Update Timestamp
                document.getElementById('update-time').textContent = data.last_updated;

                // 3. Update Movers Cards
                updateMoversCards(rawAuraData);

                // 4. Render Table (Initial Sort by Score Desc)
                handleSearchAndSort();

            } catch (error) {
                console.error('CRITICAL: Failed to load Flux - Aura Market data.', error);
                // On error, show text message (not spinner)
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-sm text-red-500">
                            Error loading data.json. Check file path and network connection.
                        </td>
                    </tr>
                `;
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        /**
         * Filters and sorts the data based on user inputs and renders the table.
         */
        function handleSearchAndSort() {
            loadingSpinner.classList.remove('hidden');

            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const sortCriteria = document.getElementById('sort-select').value;

            let filteredData = rawAuraData.filter(celeb => 
                celeb.name.toLowerCase().includes(searchTerm)
            );

            // 1. Apply Sorting
            filteredData.sort((a, b) => {
                switch (sortCriteria) {
                    case 'score_asc':
                        return a.aura_score - b.aura_score;
                    case 'change_desc':
                        return b.netMovement - a.netMovement;
                    case 'change_asc':
                        return a.netMovement - b.netMovement;
                    case 'name_asc':
                        return a.name.localeCompare(b.name);
                    case 'score_desc': // Default
                    default:
                        return b.aura_score - a.aura_score;
                }
            });

            // 2. Render the filtered and sorted data
            renderTable(filteredData);
            
            // Simulating a small delay for the animation to be visible
            setTimeout(() => {
                 loadingSpinner.classList.add('hidden');
            }, 100);
        }

        /**
         * Renders the table body with the given data array.
         */
        function renderTable(dataToRender) {
            if (dataToRender.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</td></tr>`;
                return;
            }

            tableBody.innerHTML = dataToRender.map(celeb => {
                const { text: movementText, class: movementClass } = formatMovement(celeb.netMovement);
                const { text: percentText } = formatMovement(celeb.changePercentage);

                return `
                    <tr class="hover:bg-gray-800 transition duration-150 ease-in-out">
                        <!-- Column 1: Celebrity Name -->
                        <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-white sm:pl-6">
                            ${celeb.name}
                        </td>
                        
                        <!-- Column 2: Aura Score (Current Score) -->
                        <td class="numeric px-3 py-4 text-sm text-white">
                            ${celeb.aura_score.toFixed(2)}
                        </td>
                        
                        <!-- Column 3: Previous Day's AS -->
                        <td class="hidden sm:table-cell numeric px-3 py-4 text-sm text-[--color-text-secondary]">
                            ${celeb.previous_aura_score.toFixed(2)}
                        </td>
                        
                        <!-- Column 4: Net Movement (Today's Change) -->
                        <td class="numeric px-3 py-4 text-sm ${movementClass}">
                            ${movementText}
                        </td>
                        
                        <!-- Column 5: Daily % Chg -->
                        <td class="numeric px-3 py-4 text-sm ${movementClass}">
                            ${percentText}%
                        </td>
                    </tr>
                `;
            }).join('');
        }

        /**
         * Updates the top and bottom mover summary cards.
         */
        function updateMoversCards(data) {
            if (data.length === 0) return;

            // Find Top/Bottom Movers based on Net Movement
            const topMover = data.reduce((max, celeb) => celeb.netMovement > max.netMovement ? celeb : max, data[0]);
            const bottomMover = data.reduce((min, celeb) => celeb.netMovement < min.netMovement ? celeb : min, data[0]);

            // --- Top Mover Update ---
            const topMoverMovement = formatMovement(topMover.netMovement);
            const topMoverPercent = formatMovement(topMover.changePercentage);

            document.getElementById('top-mover-name').textContent = topMover.name;
            document.getElementById('top-mover-movement').textContent = topMoverMovement.text;
            document.getElementById('top-mover-movement').className = `text-xl font-bold ${topMoverMovement.class}`;
            document.getElementById('top-mover-percent').textContent = ` (${topMoverPercent.text}%)`;
            document.getElementById('top-mover-percent').className = `ml-3 text-sm font-medium ${topMoverPercent.class}`;

            // --- Bottom Mover Update ---
            const bottomMoverMovement = formatMovement(bottomMover.netMovement);
            const bottomMoverPercent = formatMovement(bottomMover.changePercentage);
            
            // Note: The lowest mover might still be positive, but is the 'worst' performer compared to the 'best'.
            // We use the same color logic based on its own sign, not the comparison.
            const bottomMovementClass = bottomMoverMovement.isPositive ? 'text-yellow-400' : 'text-red-400';

            document.getElementById('bottom-mover-name').textContent = bottomMover.name;
            document.getElementById('bottom-mover-movement').textContent = bottomMoverMovement.text;
            document.getElementById('bottom-mover-movement').className = `text-xl font-bold ${bottomMovementClass}`;
            document.getElementById('bottom-mover-percent').textContent = ` (${bottomMoverPercent.text}%)`;
            document.getElementById('bottom-mover-percent').className = `ml-3 text-sm font-medium ${bottomMoverPercent.class}`;
        }
    </script>
</body>
</html>
